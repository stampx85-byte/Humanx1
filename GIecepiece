local DrRayLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()
local window = DrRayLibrary:Load("Fruity & Boss Hub (Complete Edition)", "Default")

-- [ Services ]
local Player = game:GetService("Players").LocalPlayer
local RS = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

-- [ Global Config ]
local Config = {
    SlimeHunter = false, KingSlimeHunter = false, EliteNoobHunter = false, KingNoobHunter = false,
    DuckHunter = false, SwordMasterHunter = false, CutieBossHunter = false, NoobyHunter = false, 
    ShinoaHunter = false, CharaHunter = false, EvilThugHunter = false, UnknownBossHunter = false,
    SansHunter = false,
    AutoRandom = false, FastAttack = false, AutoEquip = false, 
    ToolName = "OFA[Deku]", AttackRange = 60,
    AutoFruit = false, AutoMelee = false, AutoDefense = false, AutoStrength = false
}

-- [ Core Functions ]
local function GetCharacter() return Player.Character or Player.CharacterAdded:Wait() end

-- ระบบเปิดฮาคิอัตโนมัติ (เช็คก่อนเปิดรอบเดียว)
local function EnsureHaki()
    pcall(function()
        local char = GetCharacter()
        -- เช็คทั้งชื่อ Busoshoku_Effect และ Buso ตามสคริปต์เกม
        if not char:FindFirstChild("Busoshoku_Effect") and not char:FindFirstChild("Buso") then
            local HakiTool = Player.Backpack:FindFirstChild("Busoshoku") or char:FindFirstChild("Busoshoku")
            if HakiTool then 
                HakiTool.Remote.Haki_Event:FireServer() 
            end
        end
    end)
end

local function FindBoss(name)
    local targetName = string.lower(name)
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and string.lower(obj.Name) == targetName then
            local hrp = obj:FindFirstChild("HumanoidRootPart")
            local hum = obj:FindFirstChildOfClass("Humanoid")
            if hrp and hum and hum.Health > 0 then return obj, hrp, hum end
        end
    end
    return nil
end

local function DoFastAttack()
    pcall(function()
        local Char = GetCharacter()
        local Remote = Char:FindFirstChild("Combat_Event", true) or Player.Backpack:FindFirstChild("Combat_Event", true)
        local HitboxModule = require(RS:WaitForChild("Module"):WaitForChild("Hitbox"))
        if Remote and Char:FindFirstChild("HumanoidRootPart") then
            EnsureHaki() -- เปิดฮาคิให้ถ้ายังไม่ได้เปิด
            local TargetArea = HitboxModule:Overlap({
                MaxTarget = 100, Humanoid = Char.Humanoid,
                CF = Char.HumanoidRootPart.CFrame, Size = Vector3.new(Config.AttackRange, Config.AttackRange, Config.AttackRange)
            })
            if #TargetArea > 0 then 
                Remote:FireServer("Attack", TargetArea) 
                Remote:FireServer("Attack", TargetArea) -- เบิ้ลความเร็ว
            end
        end
    end)
end

-- [ UI Tabs ]
local tabFarm = DrRayLibrary.newTab("Boss Farm", "rbxassetid://4483345998")
local tabCombat = DrRayLibrary.newTab("Combat", "rbxassetid://4483345998")
local tabStats = DrRayLibrary.newTab("Stats", "rbxassetid://4483345998")
local tabShop = DrRayLibrary.newTab("Shop", "rbxassetid://4483345998")
local tabMisc = DrRayLibrary.newTab("Misc", "rbxassetid://4483345998")

-- บอสครบทุกตัว
tabFarm.newToggle("Slime", "ล่า Slime", false, function(s) Config.SlimeHunter = s end)
tabFarm.newToggle("King Slime", "ล่า King Slime", false, function(s) Config.KingSlimeHunter = s end)
tabFarm.newToggle("Elite Noob", "ล่า Elite Noob", false, function(s) Config.EliteNoobHunter = s end)
tabFarm.newToggle("King Noob", "ล่า King Noob", false, function(s) Config.KingNoobHunter = s end)
tabFarm.newToggle("Cutie Boss", "ล่า Cutie Boss", false, function(s) Config.CutieBossHunter = s end)
tabFarm.newToggle("Sans", "ล่า Sans", false, function(s) Config.SansHunter = s end)
tabFarm.newToggle("Chara", "ล่า Chara", false, function(s) Config.CharaHunter = s end)
tabFarm.newToggle("Evil Thug", "ล่า Evil Thug", false, function(s) Config.EvilThugHunter = s end)
tabFarm.newToggle("Unknown Boss", "ล่า Unknown Boss", false, function(s) Config.UnknownBossHunter = s end)
tabFarm.newToggle("Duck Boss", "ล่า Duck Boss", false, function(s) Config.DuckHunter = s end)
tabFarm.newToggle("Sword Master", "ล่า Sword Master", false, function(s) Config.SwordMasterHunter = s end)
tabFarm.newToggle("Shinoa", "ล่า Shinoa", false, function(s) Config.ShinoaHunter = s end)
tabFarm.newToggle("Nooby Hunter", "ล่า Nooby/Cutie Noob", false, function(s) Config.NoobyHunter = s end)

-- ต่อสู้
tabCombat.newToggle("Auto Equip", "บังคับถือไอเทม", false, function(s) Config.AutoEquip = s end)
tabCombat.newInput("ชื่อไอเทม", "ใส่ชื่อของที่จะถือ", function(text) Config.ToolName = text end)
tabCombat.newToggle("Fast Attack (+Haki)", "ตีเร็ว + เปิดฮาคิออโต้", false, function(s) Config.FastAttack = s end)
tabCombat.newSlider("Attack Range", "ระยะการตี", 500, false, function(num) Config.AttackRange = num end)

-- สเตตัส (ใช้ Code รีเซ็ตที่ส่งมา)
tabStats.newButton("Reset Stats (Money)", "รีเซ็ตสเตตัส (เงิน)", function()
    RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Reset","Stats","Money")
end)
tabStats.newToggle("Auto Devil Fruit", "อัพผลไม้", false, function(s) Config.AutoFruit = s end)
tabStats.newToggle("Auto Melee", "อัพหมัด", false, function(s) Config.AutoMelee = s end)
tabStats.newToggle("Auto Defense", "อัพป้องกัน", false, function(s) Config.AutoDefense = s end)
tabStats.newToggle("Auto Strength", "อัพดาบ/กำลัง", false, function(s) Config.AutoStrength = s end)

-- ร้านค้า (เพิ่มของตามที่สั่ง)
tabShop.newButton("Buy Black Leg", "ซื้อสไตล์ขาดำ", function() RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Fighting Style","Black leg") end)
tabShop.newButton("Buy Saber", "ซื้อดาบ Saber", function() RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Sword","Saber") end)
tabShop.newButton("Buy Triple Katana", "ซื้อ 3 ดาบ", function() RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Sword","Triple Katana") end)
tabShop.newButton("Buy OFA [Deku]", "ซื้อ Deku", function() RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Fighting Style","OFA [Deku]") end)
tabShop.newButton("Buy Soru", "ซื้อโซรุ", function() RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Technique","Soru") end)
tabShop.newButton("Buy Geppo", "ซื้อเก็ปโปะ", function() RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Technique","Geppo") end)
tabShop.newButton("Buy Buso Haki", "ซื้อฮาคิ", function() RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Haki","BusoHaki") end)

-- อื่นๆ (ใช้ Code สุ่มผลที่ส่งมา)
tabMisc.newToggle("Auto Random Fruity", "สุ่มผลไม้อัตโนมัติ", false, function(s) Config.AutoRandom = s end)

-- [ Main Loops ]
task.spawn(function()
    while true do
        RunService.Heartbeat:Wait()
        pcall(function()
            local Char = GetCharacter()
            local Hrp = Char.HumanoidRootPart
            local Hum = Char.Humanoid
            
            local targetName = nil
            if Config.SlimeHunter then targetName = "Slime"
            elseif Config.KingSlimeHunter then targetName = "King Slime"
            elseif Config.EliteNoobHunter then targetName = "Elite Noob"
            elseif Config.KingNoobHunter then targetName = "King Noob"
            elseif Config.CutieBossHunter then targetName = "cutie boss"
            elseif Config.SansHunter then targetName = "Sans"
            elseif Config.CharaHunter then targetName = "Chara"
            elseif Config.EvilThugHunter then targetName = "Evil Thug"
            elseif Config.UnknownBossHunter then targetName = "Unknown Boss"
            elseif Config.DuckHunter then targetName = "Duck Boss"
            elseif Config.SwordMasterHunter then targetName = "Sword Master"
            elseif Config.ShinoaHunter then targetName = "Shinoa"
            elseif Config.NoobyHunter then
                local b, bh, bu = FindBoss("nooby")
                if not b then b, bh, bu = FindBoss("cutie noob") end
                if b then
                    Hum.PlatformStand = true
                    Hrp.CFrame = CFrame.new(bh.Position + Vector3.new(0, 2.5, 0), bh.Position)
                    Hrp.Velocity = Vector3.new(0,0,0)
                    DoFastAttack()
                    return
                end
            end

            if targetName then
                local b, bh, bu = FindBoss(targetName)
                if b then
                    Hum.PlatformStand = true
                    Hrp.CFrame = CFrame.new(bh.Position + Vector3.new(0, 2.8, 0), bh.Position)
                    Hrp.Velocity = Vector3.new(0,0,0)
                    DoFastAttack()
                else
                    Hum.PlatformStand = false
                end
            elseif Config.FastAttack then
                DoFastAttack()
            else
                Hum.PlatformStand = false
            end
        end)
    end
end)

task.spawn(function()
    while task.wait(0.3) do
        if Config.AutoRandom then RS.Remote.RemoteEvent.Shop_Event:FireServer("Shop","Random Fruity","Money") end
        if Config.AutoEquip then
            local t = Player.Backpack:FindFirstChild(Config.ToolName)
            if t then GetCharacter().Humanoid:EquipTool(t) end
        end
        if Config.AutoFruit then RS.Remote.RemoteEvent.UI_Event:FireServer("Add Stats","DevilFruit","1") end
        if Config.AutoMelee then RS.Remote.RemoteEvent.UI_Event:FireServer("Add Stats","Melee","1") end
        if Config.AutoDefense then RS.Remote.RemoteEvent.UI_Event:FireServer("Add Stats","Defense","1") end
        if Config.AutoStrength then RS.Remote.RemoteEvent.UI_Event:FireServer("Add Stats","Strength","1") end
    end
end)
