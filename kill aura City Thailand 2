local plr = game.Players.LocalPlayer

function missing(t, f, fallback)
    if type(f) == t then return f end
    return fallback
end
    
cloneref = missing("function", cloneref, function(...) return ... end)
    
local Services = setmetatable({}, {
  __index = function(_, name)
      return cloneref(game:GetService(name))
  end
})
    
local Players = Services.Players
local RunService = Services.RunService
local StarterGui = Services.StarterGui
    

if game.PlaceId == 4503309821 then
    local function onCharacterAdded(p)
        StarterGui:SetCore("SendNotification",{
          Title="Credit : Human",
          Text="Anti Crash has been active",
          Duration=10
        })
        local strgui = game:WaitForChild("StarterGui")
        local plrgui = p:WaitForChild("PlayerGui")
      
        local strAncm = strgui:WaitForChild("Announcement")
        local plrAncm = plrgui:WaitForChild("Announcement")
        local AncmFrame = plrAncm:WaitForChild("Frame")
        plrAncm:Destroy()
        plrgui.ChildAdded:Connect(function(gui)
            if gui.Name == "Announcement" then
                gui:Destroy()
            end
        end)
    end  
    
    plr.CharacterAdded:Connect(onCharacterAdded)
    
    if plr or plr.Character then
        onCharacterAdded(plr)
        
    end
end

-- Script generated by TurtleSpy, made by Intrer#0421
game:GetService("ReplicatedStorage").BloxbizRemotes.CatalogOnApplyToRealHumanoid:FireServer({["BodyColor"] = Color3.new(0.780392, 0.67451, 0.470588)})

-- โหลด Library DrRay UI
local DrRayLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()
local window = DrRayLibrary:Load("Multi-Hub System (Rainbow Edition)", "Default")

---------------------------------------------------------
-- [ SETTINGS & VARIABLES ]
---------------------------------------------------------
local RunService = game:GetService("RunService")
local autoSwapEnabled = false
local autoPhoneKill = false 
local shootForwardEnabled = false 
local lockOnEnabled = true
local autoClaimEnabled = true 
local tpAboveHeadEnabled = false
local orbitSpinEnabled = false 
local spinLockEnabled = false
local autoBuyLoop = false
local autoBuyPhoneLoop = false
local autoBuyBoomboxLoop = false
local autoSellEnabled = false 
local targetSearchName = ""

-- Hitbox Settings
local hitboxEnabled = false
local hitboxSize = 15 

-- Rainbow & Scroll Settings
local rainbowNameEnabled = false
local rainbowBoomboxEnabled = false
local rainbowCharacterEnabled = false
local customNameTag = "Script Word [TH]" 

---------------------------------------------------------
-- [ FUNCTION: UTILS ]
---------------------------------------------------------
local function getClosestPlayer(range)
    local closestPlayer = nil
    local shortestDistance = range
    local localPlayer = game.Players.LocalPlayer
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character.Humanoid.Health > 0 then
            local distance = (localPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                closestPlayer = player
            end
        end
    end
    return closestPlayer
end

local function safeUltraShoot(targetPos)
    local player = game.Players.LocalPlayer
    local character = player.Character
    if not character then return end
    local tools = {}
    for _, item in ipairs(player.Backpack:GetChildren()) do if item:IsA("Tool") then table.insert(tools, item) end end
    for _, item in ipairs(character:GetChildren()) do if item:IsA("Tool") then table.insert(tools, item) end end
    for i, tool in ipairs(tools) do
        local remote = tool:FindFirstChild("shot") or tool:FindFirstChild("RemoteEvent")
        if remote then
            task.spawn(function()
                character.Humanoid:EquipTool(tool)
                remote:FireServer(targetPos)
            end)
            if i % 3 == 0 then task.wait(0.001) end
        end
    end
end

-- [ Logic สลับ Phone ]
local function safePhoneSpam(targetPlayer)
    local player = game.Players.LocalPlayer
    local character = player.Character
    if not character or not targetPlayer then return end
    
    local phones = {}
    for _, item in ipairs(player.Backpack:GetChildren()) do if item.Name == "Phone" then table.insert(phones, item) end end
    for _, item in ipairs(character:GetChildren()) do if item.Name == "Phone" then table.insert(phones, item) end end
    
    for i, phone in ipairs(phones) do
        local remote = phone:FindFirstChild("RemoteEvent")
        if remote then
            task.spawn(function()
                character.Humanoid:EquipTool(phone)
                remote:FireServer(targetPlayer)
            end)
            if i % 2 == 0 then task.wait() end
        end
    end
end

local mouse = plr:GetMouse()
mouse.Button1Down:Connect(function()
    if autoPhoneKill and mouse.Target then
        local model = mouse.Target:FindFirstAncestorWhichIsA("Model")
        local targetPlr = model and game.Players:GetPlayerFromCharacter(model)
        if targetPlr then safePhoneSpam(targetPlr) end
    end
end)

---------------------------------------------------------
-- [ TAB 1: COMBAT ]
---------------------------------------------------------
local mainTab = DrRayLibrary.newTab("Combat", "rbxassetid://10734951151")

mainTab.newToggle("Auto Phone Kill", "สลับโทรศัพท์รัว (เปิดแล้วคลิกที่คนหรือจะออโต้คนใกล้)", false, function(state)
    autoPhoneKill = state
    task.spawn(function()
        while autoPhoneKill do
            local target = getClosestPlayer(1000)
            if target then
                safePhoneSpam(target)
            end
            task.wait(0.01)
        end
    end)
end)

mainTab.newToggle("Hitbox Expander", "ขยายขนาดตัวคนอื่นให้ตีกดง่ายขึ้น", false, function(state)
    hitboxEnabled = state
    task.spawn(function()
        while hitboxEnabled do
            for _, v in ipairs(game.Players:GetPlayers()) do
                if v ~= game.Players.LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                    v.Character.HumanoidRootPart.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize)
                    v.Character.HumanoidRootPart.Transparency = 0.7
                    v.Character.HumanoidRootPart.BrickColor = BrickColor.new("Really blue")
                    v.Character.HumanoidRootPart.Material = "Neon"
                    v.Character.HumanoidRootPart.CanCollide = false
                end
            end
            task.wait(1)
        end
        for _, v in ipairs(game.Players:GetPlayers()) do
            if v ~= game.Players.LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                v.Character.HumanoidRootPart.Size = Vector3.new(2, 2, 1)
                v.Character.HumanoidRootPart.Transparency = 1
                v.Character.HumanoidRootPart.CanCollide = true
            end
        end
    end)
end)

mainTab.newToggle("Warp & Orbit Spin", "วาร์ปไปหมุนวนรอบเป้าหมาย (กันโดนยิง)", false, function(state)
    orbitSpinEnabled = state
    local angle = 0
    if orbitSpinEnabled then
        task.spawn(function()
            while orbitSpinEnabled do
                local dt = RunService.Heartbeat:Wait() 
                if targetSearchName ~= "" then
                    for _, v in ipairs(game.Players:GetPlayers()) do
                        if v.Name:lower():find(targetSearchName:lower()) and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                            local root = v.Character.HumanoidRootPart
                            local pChar = game.Players.LocalPlayer.Character
                            if pChar and pChar:FindFirstChild("HumanoidRootPart") then
                                angle = angle + (5 * dt)
                                local offset = Vector3.new(math.cos(angle) * 7, 3, math.sin(angle) * 7)
                                pChar.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
                                pChar.HumanoidRootPart.CFrame = CFrame.new(root.Position + offset, root.Position)
                                safeUltraShoot(root.Position)
                            end
                            break
                        end
                    end
                end
            end
        end)
    end
end)

mainTab.newToggle("Shoot Forward Only", "ยิงรัวไปข้างหน้าตรงๆ", false, function(state)
    shootForwardEnabled = state
    task.spawn(function()
        while shootForwardEnabled do
            local char = game.Players.LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local forwardPos = char.HumanoidRootPart.Position + (char.HumanoidRootPart.CFrame.LookVector * 500)
                safeUltraShoot(forwardPos)
            end
            task.wait(0.01)
        end
    end)
end)

mainTab.newToggle("Ultra Fast Swap", "ยิงรัวแบบล็อคเป้าคนใกล้", false, function(state)
    autoSwapEnabled = state
    task.spawn(function()
        while autoSwapEnabled do
            local char = game.Players.LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local target = getClosestPlayer(1000)
                if target then safeUltraShoot(target.Character.HumanoidRootPart.Position) end
            end
            task.wait(0.01)
        end
    end)
end)

mainTab.newLabel("Warp System")
mainTab.newInput("Target Name", "ใส่ชื่อคนที่จะตาม", function(t) targetSearchName = t end)

mainTab.newToggle("Warp & Kill (Above)", "วาร์ปยิงบนหัวนิ่งๆ", false, function(state)
    tpAboveHeadEnabled = state
    task.spawn(function()
        local p = game.Players.LocalPlayer
        while tpAboveHeadEnabled do
            if targetSearchName ~= "" then
                for _, v in ipairs(game.Players:GetPlayers()) do
                    if v.Name:lower():find(targetSearchName:lower()) and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                        p.Character.HumanoidRootPart.CFrame = v.Character.HumanoidRootPart.CFrame * CFrame.new(0, 7, 0)
                        p.Character.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
                        safeUltraShoot(v.Character.HumanoidRootPart.Position)
                        break 
                    end
                end
            end
            task.wait(0.01)
        end
    end)
end)

---------------------------------------------------------
-- [ TAB 2: VISUALS ]
---------------------------------------------------------
local visualTab = DrRayLibrary.newTab("Visuals", "rbxassetid://10734951151")

visualTab.newInput("Custom Name", "เปลี่ยนคำในชื่อรุ้ง", function(t)
    customNameTag = t
end)

-- [ อัปเดตส่วนเลื่อนชื่อสลับทิศทาง ]
visualTab.newToggle("Rainbow Bounce Scroll", "เลื่อนชื่อซ้ายไปขวา-ขวาไปซ้าย", false, function(state)
    rainbowNameEnabled = state
    if rainbowNameEnabled then
        task.spawn(function()
            local hue = 0
            local scrollPos = 1
            local direction = 1 -- 1 คือไปขวา, -1 คือไปซ้าย
            while rainbowNameEnabled do
                hue = hue + (1/400)
                if hue > 1 then hue = 0 end
                local color = Color3.fromHSV(hue, 1, 1)
                
                local fullText = "          " .. customNameTag .. "          "
                local displayPart = string.sub(fullText, scrollPos, scrollPos + 15)
                
                game:GetService("ReplicatedStorage").NameTagRemoteEvent:FireServer(displayPart, color, 38)
                
                scrollPos = scrollPos + direction
                
                -- ตรวจสอบเพื่อเปลี่ยนทิศทาง
                if scrollPos > (string.len(fullText) - 15) then
                    direction = -1
                elseif scrollPos < 1 then
                    direction = 1
                end
                
                task.wait(0.12)
            end
        end)
    end
end)

visualTab.newToggle("Rainbow Character", "เปลี่ยนสีตัวละครเป็นสีรุ้ง", false, function(state)
    rainbowCharacterEnabled = state
    if rainbowCharacterEnabled then
        task.spawn(function()
            local hue = 0
            while rainbowCharacterEnabled do
                hue = hue + (1/100)
                if hue > 1 then hue = 0 end
                local rainbowColor = Color3.fromHSV(hue, 1, 1)
                game:GetService("ReplicatedStorage").BloxbizRemotes.CatalogOnApplyToRealHumanoid:FireServer({["BodyColor"] = rainbowColor})
                task.wait(0.1)
            end
        end)
    end
end)

visualTab.newToggle("Rainbow Boombox", "วิทยุสีรุ้ง 12 สี", false, function(state)
    rainbowBoomboxEnabled = state
    if rainbowBoomboxEnabled then
        task.spawn(function()
            local colors = {
                "Really red", "Deep orange", "New Yeller", "Lime green", 
                "Electric blue", "Really blue", "Hot pink", "Institutional white",
                "Black", "Magenta", "Cyan", "Alder"
            }
            local index = 1
            while rainbowBoomboxEnabled do
                local selectedColor = BrickColor.new(colors[index])
                workspace.DRadio_Script.Color:FireServer(selectedColor)
                index = index + 1
                if index > #colors then index = 1 end
                task.wait(0.3)
            end
        end)
    end
end)

---------------------------------------------------------
-- [ TAB 3: AUTO FARM ]
---------------------------------------------------------
local farmTab = DrRayLibrary.newTab("Auto Farm", "rbxassetid://10734951151")
farmTab.newToggle("Auto Sell (ปั๊มเงิน)", "ปั๊มเงินอัตโนมัติ (House)", false, function(state)
    autoSellEnabled = state
    if autoSellEnabled then
        task.spawn(function()
            local HouseEvent = game:GetService("ReplicatedStorage"):WaitForChild("House")
            while autoSellEnabled do HouseEvent:FireServer("Sell") task.wait(0.01) end
        end)
    end
end)

---------------------------------------------------------
-- [ TAB 4: AUTO SHOP ]
---------------------------------------------------------
local shopTab = DrRayLibrary.newTab("Auto Shop", "rbxassetid://10734951151")

shopTab.newToggle("Auto Claim Items", "ดึงของคืนอัตโนมัติ", true, function(state) 
    autoClaimEnabled = state 
end)
task.spawn(function() while task.wait(0.5) do if autoClaimEnabled then game:GetService("ReplicatedStorage").GetItemBack:FireServer() end end end)

-- [ Helper Function: Find Closest Click ]
local function findAndClick(targetPos)
    local closestClick = nil
    local shortestDistance = 10 
    for _, v in ipairs(game.Workspace:GetDescendants()) do
        if v:IsA("ClickDetector") then
            local part = v.Parent
            if part and part:IsA("BasePart") then
                local distance = (part.Position - targetPos).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestClick = v
                end
            end
        end
    end
    if closestClick then fireclickdetector(closestClick) return true end
    return false
end

local function autoBuyGun() return findAndClick(Vector3.new(-76.84, 162.67, 231.24)) end
local function autoBuyPhone() return findAndClick(Vector3.new(89.44, 176.45, 269.08)) end
local function autoBuyBoombox() return findAndClick(Vector3.new(89.44, 176.45, 256.52)) end

shopTab.newToggle("Auto Buy Gun Loop (30 Pcs)", "ซื้อปืน 30 อันเข้าตัว", false, function(state)
    autoBuyLoop = state
    if autoBuyLoop then
        task.spawn(function()
            local toolStorage = game:GetService("ReplicatedStorage"):WaitForChild("ToolStorage"):WaitForChild("ToolsStorage")
            while autoBuyLoop do
                for i = 1, 30 do if not autoBuyLoop then break end if autoBuyGun() then task.wait(0.1) toolStorage:FireServer("Save", "Gun") end end
                task.wait(0.5)
                for i = 1, 30 do 
                    if not autoBuyLoop then break end 
                    toolStorage:FireServer("Get", "Gun") 
                    task.spawn(function() task.wait(0.05) if plr.Character and plr.Character:FindFirstChildOfClass("Humanoid") then plr.Character.Humanoid:UnequipTools() end end)
                    task.wait(0.05) 
                end
                task.wait(2)
            end
        end)
    end
end)

shopTab.newToggle("Auto Buy Phone Loop (30 Pcs)", "ซื้อโทรศัพท์ 30 อันเข้าตัว", false, function(state)
    autoBuyPhoneLoop = state
    if autoBuyPhoneLoop then
        task.spawn(function()
            local toolStorage = game:GetService("ReplicatedStorage"):WaitForChild("ToolStorage"):WaitForChild("ToolsStorage")
            while autoBuyPhoneLoop do
                for i = 1, 30 do if not autoBuyPhoneLoop then break end if autoBuyPhone() then task.wait(0.1) toolStorage:FireServer("Save", "Phone") end end
                task.wait(0.5)
                for i = 1, 30 do 
                    if not autoBuyPhoneLoop then break end 
                    toolStorage:FireServer("Get", "Phone") 
                    task.spawn(function() task.wait(0.05) if plr.Character and plr.Character:FindFirstChildOfClass("Humanoid") then plr.Character.Humanoid:UnequipTools() end end)
                    task.wait(0.05) 
                end
                task.wait(2)
            end
        end)
    end
end)

shopTab.newToggle("Auto Buy Boombox Loop (30 Pcs)", "ซื้อบูมบ็อกซ์ 30 อันเข้าตัว", false, function(state)
    autoBuyBoomboxLoop = state
    if autoBuyBoomboxLoop then
        task.spawn(function()
            local toolStorage = game:GetService("ReplicatedStorage"):WaitForChild("ToolStorage"):WaitForChild("ToolsStorage")
            while autoBuyBoomboxLoop do
                for i = 1, 30 do if not autoBuyBoomboxLoop then break end if autoBuyBoombox() then task.wait(0.1) toolStorage:FireServer("Save", "Boombox") end end
                task.wait(0.5)
                for i = 1, 30 do 
                    if not autoBuyBoomboxLoop then break end 
                    toolStorage:FireServer("Get", "Boombox") 
                    task.spawn(function() task.wait(0.05) if plr.Character and plr.Character:FindFirstChildOfClass("Humanoid") then plr.Character.Humanoid:UnequipTools() end end)
                    task.wait(0.05) 
                end
                task.wait(2)
            end
        end)
    end
end)

---------------------------------------------------------
-- [ TAB 5: MISC ]
---------------------------------------------------------
local miscTab = DrRayLibrary.newTab("Misc", "rbxassetid://10734951151")

-- ปุ่ม Speed (เหมือนเดิม)
local speedEnabled = false
miscTab.newToggle("Super Speed (80)", "เปิดเพื่อวิ่งไว", false, function(state)
    speedEnabled = state
    task.spawn(function()
        while speedEnabled do
            if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                plr.Character.Humanoid.WalkSpeed = 80
            end
            task.wait(0.1)
        end
        if plr.Character and plr.Character:FindFirstChild("Humanoid") then plr.Character.Humanoid.WalkSpeed = 16 end
    end)
end)

-- ปุ่ม Jump (เหมือนเดิม)
local jumpEnabled = false
miscTab.newToggle("Super Jump (100)", "เปิดเพื่อกระโดดสูง", false, function(state)
    jumpEnabled = state
    task.spawn(function()
        while jumpEnabled do
            if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                plr.Character.Humanoid.UseJumpPower = true
                plr.Character.Humanoid.JumpPower = 100
            end
            task.wait(0.1)
        end
        if plr.Character and plr.Character:FindFirstChild("Humanoid") then plr.Character.Humanoid.JumpPower = 50 end
    end)
end)

-- ฟังก์ชันนอนเดิม
miscTab.newButton("Auto Lie & Return", "วาร์ปไปนอน 3 วิแล้ววาร์ปกลับ", function()
    local char = plr.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    
    if hrp and hum then
        local clickPos = Vector3.new(514.24, 178.53, -126.68)
        
        hrp.CFrame = CFrame.new(522.184937, 178.182083, -130.85817)
        task.wait(0.1)
        
        local bg = Instance.new("BodyGyro")
        bg.P = 30000
        bg.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
        bg.CFrame = hrp.CFrame * CFrame.Angles(math.rad(-90), 0, 0)
        bg.Parent = hrp
        
        hum.PlatformStand = true 
        
        findAndClick(clickPos)
        task.wait(3)
        findAndClick(clickPos)
        task.wait(0.1)
        
        bg:Destroy()
        hum.PlatformStand = false
        hrp.CFrame = CFrame.new(61.7608337, 177.280991, 211.880569)
    end
end)
