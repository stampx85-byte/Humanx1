-- โหลด Library DrRay UI
local DrRayLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()
local window = DrRayLibrary:Load("Multi-Hub System (Rainbow Full)", "Default")

---------------------------------------------------------
-- [ SETTINGS & VARIABLES ]
---------------------------------------------------------
local RunService = game:GetService("RunService")
local autoSwapEnabled = false
local shootForwardEnabled = false 
local targetSearchName = ""
local autoClaimEnabled = true 
local autoBuyLoop = false
local autoSellEnabled = false 

-- Rainbow Settings
local rainbowNameEnabled = false
local rainbowBoomboxEnabled = false
local rainbowBodyEnabled = false -- ตัวแปรใหม่สำหรับตัวรุ้ง
local customNameTag = "Script Word [TH]"

---------------------------------------------------------
-- [ FUNCTION: UTILS ]
---------------------------------------------------------
local function getClosestPlayer(range)
    local closestPlayer = nil
    local shortestDistance = range
    local localPlayer = game.Players.LocalPlayer
    for _, player in ipairs(game.Players:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character.Humanoid.Health > 0 then
            local distance = (localPlayer.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                closestPlayer = player
            end
        end
    end
    return closestPlayer
end

local function safeUltraShoot(targetPos)
    local player = game.Players.LocalPlayer
    local character = player.Character
    if not character then return end
    local tools = {}
    for _, item in ipairs(player.Backpack:GetChildren()) do if item:IsA("Tool") then table.insert(tools, item) end end
    for _, item in ipairs(character:GetChildren()) do if item:IsA("Tool") then table.insert(tools, item) end end
    for i, tool in ipairs(tools) do
        local remote = tool:FindFirstChild("shot") or tool:FindFirstChild("RemoteEvent")
        if remote then
            task.spawn(function()
                character.Humanoid:EquipTool(tool)
                remote:FireServer(targetPos)
            end)
            if i % 3 == 0 then task.wait(0.001) end
        end
    end
end

---------------------------------------------------------
-- [ TAB: COMBAT ]
---------------------------------------------------------
local mainTab = DrRayLibrary.newTab("Combat", "rbxassetid://10734951151")

mainTab.newToggle("Warp & Orbit Spin", "หมุนวนรอบเป้าหมาย", false, function(state)
    orbitSpinEnabled = state
    local angle = 0
    if orbitSpinEnabled then
        task.spawn(function()
            while orbitSpinEnabled do
                local dt = RunService.Heartbeat:Wait() 
                if targetSearchName ~= "" then
                    for _, v in ipairs(game.Players:GetPlayers()) do
                        if v.Name:lower():find(targetSearchName:lower()) and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                            local root = v.Character.HumanoidRootPart
                            local pChar = game.Players.LocalPlayer.Character
                            if pChar and pChar:FindFirstChild("HumanoidRootPart") then
                                angle = angle + (5 * dt)
                                local offset = Vector3.new(math.cos(angle) * 7, 3, math.sin(angle) * 7)
                                pChar.HumanoidRootPart.CFrame = CFrame.new(root.Position + offset, root.Position)
                                safeUltraShoot(root.Position)
                            end
                            break
                        end
                    end
                end
            end
        end)
    end
end)

mainTab.newInput("Target Name", "ใส่ชื่อเป้าหมาย", function(t) targetSearchName = t end)

---------------------------------------------------------
-- [ TAB: VISUALS (เพิ่มตัวรุ้งที่นี่) ]
---------------------------------------------------------
local visualTab = DrRayLibrary.newTab("Visuals", "rbxassetid://10734951151")

-- ส่วนของตัวรุ้ง (Rainbow Body)
visualTab.newToggle("Rainbow Body", "เปลี่ยนสีตัวละครแบบรุ้ง Smooth", false, function(state)
    rainbowBodyEnabled = state
    if rainbowBodyEnabled then
        task.spawn(function()
            local hue = 0
            while rainbowBodyEnabled do
                hue = hue + (1/200) -- ปรับความเร็วตรงนี้
                if hue > 1 then hue = 0 end
                local rainbowColor = Color3.fromHSV(hue, 1, 1)
                
                -- ส่ง Event เปลี่ยนสีตัว
                game:GetService("ReplicatedStorage").BloxbizRemotes.CatalogOnApplyToRealHumanoid:FireServer({
                    ["BodyColor"] = rainbowColor
                })
                task.wait(0.1) -- หน่วงเวลาเพื่อไม่ให้เซิร์ฟเวอร์เตะ
            end
        end)
    end
end)

visualTab.newInput("Custom Name", "เปลี่ยนชื่อรุ้ง", function(t) customNameTag = t end)

visualTab.newToggle("Rainbow Name", "เปิดชื่อสีรุ้ง", false, function(state)
    rainbowNameEnabled = state
    if rainbowNameEnabled then
        task.spawn(function()
            local hue = 0
            while rainbowNameEnabled do
                hue = hue + (1/300)
                if hue > 1 then hue = 0 end
                game:GetService("ReplicatedStorage").NameTagRemoteEvent:FireServer(customNameTag, Color3.fromHSV(hue, 1, 1), 38)
                task.wait(0.1)
            end
        end)
    end
end)

visualTab.newToggle("Rainbow Boombox", "วิทยุ 12 สี", false, function(state)
    rainbowBoomboxEnabled = state
    if rainbowBoomboxEnabled then
        task.spawn(function()
            local colors = {"Really red", "Deep orange", "New Yeller", "Lime green", "Electric blue", "Really blue", "Hot pink", "Institutional white", "Black", "Magenta", "Cyan", "Alder"}
            local index = 1
            while rainbowBoomboxEnabled do
                workspace.DRadio_Script.Color:FireServer(BrickColor.new(colors[index]))
                index = (index % #colors) + 1
                task.wait(0.3)
            end
        end)
    end
end)

---------------------------------------------------------
-- [ TAB: OTHERS ]
---------------------------------------------------------
local farmTab = DrRayLibrary.newTab("Auto Farm", "rbxassetid://10734951151")
farmTab.newToggle("Auto Sell", "ขายของอัตโนมัติ", false, function(state)
    autoSellEnabled = state
    if autoSellEnabled then
        task.spawn(function()
            while autoSellEnabled do 
                game:GetService("ReplicatedStorage").House:FireServer("Sell") 
                task.wait(0.01) 
            end
        end)
    end
end)

local antiTab = DrRayLibrary.newTab("Anti-Jail", "rbxassetid://10734951151")
antiTab.newToggle("Auto Claim Items", "ดึงของคืน", true, function(state) autoClaimEnabled = state end)
task.spawn(function() while task.wait(0.5) do if autoClaimEnabled then game:GetService("ReplicatedStorage").GetItemBack:FireServer() end end end)
